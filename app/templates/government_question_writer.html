{% extends "base.html" %}

{% block title %}Government Question Writer - CollinsGPT{% endblock %}

{% block content %}
<!-- Header -->
<div class="mb-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-2">
            <li class="breadcrumb-item"><a href="{{ url_for('main.index') }}" class="text-decoration-none">Dashboard</a></li>
            <li class="breadcrumb-item active" aria-current="page">Government Question Writer</li>
        </ol>
    </nav>
    <div class="d-flex align-items-center">
        <div class="rounded bg-labor-light d-flex align-items-center justify-content-center me-3" style="width: 48px; height: 48px;">
            <i class="bi bi-mic-fill fs-4 text-labor"></i>
        </div>
        <div>
            <h1 class="h3 fw-bold text-dark mb-0">Government Question Writer</h1>
            <p class="text-muted mb-0">Generate parliamentary questions and ministerial answers</p>
        </div>
    </div>
</div>

<!-- Error Alert -->
<div id="error-alert" class="alert alert-danger alert-dismissible fade show d-none" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>
    <span id="error-message"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>

<div class="row">
    <!-- Input Form -->
    <div class="col-lg-5 mb-4">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom py-3">
                <h5 class="mb-0 fw-semibold">
                    <i class="bi bi-pencil-square me-2 text-labor"></i>Input Details
                </h5>
            </div>
            <div class="card-body p-4">
                <form id="government-question-form" method="post" action="{{ url_for('main.government_question_writer_stream') }}">
                    {{ form.hidden_tag() }}
                    <!-- Answer Word Count -->
                    <div class="mb-4">
                        <label for="word_count" class="form-label fw-semibold">
                            Answer Length: <span id="word-count-value" class="text-labor">{{ form.word_count.data }}</span> words
                        </label>
                        <input
                            type="range"
                            class="form-range"
                            id="word_count"
                            name="word_count"
                            min="100"
                            max="400"
                            step="25"
                            value="{{ form.word_count.data }}">
                        <div class="d-flex justify-content-between">
                            <small class="text-muted">100</small>
                            <small class="text-muted">250</small>
                            <small class="text-muted">400</small>
                        </div>
                        <div class="form-text">Target word count for the Minister's answer.</div>
                    </div>

                    <!-- Topic/Announcement -->
                    <div class="mb-4">
                        <label for="topic" class="form-label fw-semibold">
                            Topic / Announcement <span class="text-danger">*</span>
                        </label>
                        <textarea
                            class="form-control"
                            id="topic"
                            name="topic"
                            rows="4"
                            placeholder="Enter the core policy, funding announcement, or news story..."
                            required>{{ form.topic.data }}</textarea>
                        <div class="form-text">The main subject the question will be about.</div>
                    </div>

                    <!-- Other instructions -->
                    <div class="mb-4">
                        <label for="other_instructions" class="form-label fw-semibold">
                          Other Instructions
                        </label>
                        <textarea
                            class="form-control"
                            id="other_instructions"
                            name="other_instructions"
                            rows="4"
                            placeholder="Enter the core policy, funding announcement, or news story..."
                            required>{{ form.other_instructions.data }}</textarea>
                        <div class="form-text">(Optional) any other instructions to give the AI model</div>
                    </div>

                    <!-- Strategy -->
                    <div class="mb-4">
                        <label for="strategy" class="form-label fw-semibold">
                            Strategy <span class="text-danger">*</span>
                        </label>
                        <select class="form-select" id="strategy" name="strategy" required>
                            <option value="option_a" {% if form.strategy.data == 'option_a' %}selected{% endif %}>
                                Option A: Good News (Positive)
                            </option>
                            <option value="option_b" {% if form.strategy.data == 'option_b' %}selected{% endif %}>
                                Option B: Contrast (Attack)
                            </option>
                        </select>
                        <div class="form-text">
                            <strong>Option A:</strong> Highlight positive government action.<br>
                            <strong>Option B:</strong> Contrast with Opposition failures.
                        </div>
                    </div>

                    <!-- AI Model -->
                    <div class="mb-4">
                        <label for="model" class="form-label fw-semibold">
                            AI Model <span class="text-danger">*</span>
                        </label>
                        <select class="form-select form-select-sm" id="model" name="model" required>
                            <option value="anthropic/claude-sonnet-4.5" {% if form.model.data == 'anthropic/claude-sonnet-4.5' %}selected{% endif %}>
                                Claude Sonnet 4.5
                            </option>
                            <option value="google/gemini-2.5-flash" {% if form.model.data == 'google/gemini-2.5-flash' %}selected{% endif %}>
                                Gemini 2.5 Flash
                            </option>
                            <option value="openai/gpt-5-mini" {% if form.model.data == 'openai/gpt-5-mini' %}selected{% endif %}>
                                GPT-5 Mini
                            </option>
                            <option value="openai/gpt-5.1" {% if form.model.data == 'openai/gpt-5.1' %}selected{% endif %}>
                                GPT-5.1
                            </option>
                        </select>
                        <div class="form-text">Test different AI models to compare output quality.</div>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" id="submit-btn" class="btn btn-labor w-100 py-2">
                        <span id="btn-text"><i class="bi bi-magic me-2"></i>Generate Government Question</span>
                        <span id="btn-loading" class="d-none">
                            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                            Generating...
                        </span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Output Section -->
    <div class="col-lg-7 mb-4">
        <!-- Loading State -->
        <div id="loading-state" class="d-none">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center mb-3">
                        <div class="spinner-grow spinner-grow-sm text-labor me-3" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <span class="fw-semibold text-muted">Generating your government question...</span>
                    </div>
                    <div class="progress" style="height: 4px;">
                        <div class="progress-bar progress-bar-striped progress-bar-animated bg-labor" role="progressbar" style="width: 100%"></div>
                    </div>
                </div>
            </div>

            <!-- Streaming Output Preview -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-secondary text-white py-3">
                    <h5 class="mb-0 fw-semibold">
                        <i class="bi bi-braces me-2"></i>Raw Output
                    </h5>
                    <small class="opacity-75">Streaming response...</small>
                </div>
                <div class="card-body p-4">
                    <div id="stream-output" class="stream-output" style="white-space: pre-line; font-family: inherit; min-height: 200px;"></div>
                    <span id="cursor" class="typing-cursor">|</span>
                </div>
            </div>
        </div>

        <!-- Result State -->
        <div id="result-state" class="d-none">
            <!-- Question Card -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-labor text-white py-3">
                    <h5 class="mb-0 fw-semibold">
                        <i class="bi bi-chat-left-quote-fill me-2"></i>The Question
                    </h5>
                    <small class="opacity-75">For the Backbencher to ask</small>
                </div>
                <div class="card-body p-4">
                    <div id="question-text" class="question-text" style="white-space: pre-line;"></div>
                    <hr class="my-3">
                    <button class="btn btn-sm btn-outline-secondary" onclick="copyToClipboard('question')">
                        <i class="bi bi-clipboard me-1"></i>Copy Question
                    </button>
                </div>
            </div>

            <!-- Answer Card -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-success text-white py-3">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h5 class="mb-0 fw-semibold">
                                <i class="bi bi-chat-right-quote-fill me-2"></i>The Answer
                            </h5>
                            <small class="opacity-75">Minister Collins' Response</small>
                        </div>
                        <div class="text-end">
                            <small class="opacity-75 d-block">Word Count</small>
                            <span id="answer-word-count" class="badge bg-white text-success fw-bold fs-6">0</span>
                        </div>
                    </div>
                </div>
                <div class="card-body p-4">
                    <div id="answer-text" class="answer-text" style="white-space: pre-line;"></div>
                    <hr class="my-3">
                    <button class="btn btn-sm btn-outline-secondary" onclick="copyToClipboard('answer')">
                        <i class="bi bi-clipboard me-1"></i>Copy Answer
                    </button>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="card border-0 shadow-sm h-100">
            <div class="card-body d-flex flex-column align-items-center justify-content-center text-center p-5" style="min-height: 400px;">
                <div class="rounded-circle bg-light d-flex align-items-center justify-content-center mb-4" style="width: 80px; height: 80px;">
                    <i class="bi bi-chat-square-text fs-1 text-muted"></i>
                </div>
                <h5 class="text-muted fw-semibold">No Output Yet</h5>
                <p class="text-muted mb-0">Fill in the form and click "Generate Government Question" to create a parliamentary question and answer.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Page-specific TypeScript module -->
<script type="module" src="{{ vite_asset('pages/government-question-writer.ts') }}"></script>
{% endblock %}
